<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Poisson Regression - Basic concepts</title>
    <meta charset="utf-8" />
    <meta name="author" content="Mabel Carabali" />
    <script src="libs/header-attrs-2.25/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="extra.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: left, middle, inverse, title-slide

.title[
# Poisson Regression - Basic concepts
]
.author[
### Mabel Carabali
]
.institute[
### EBOH, McGill University
]
.date[
### updated: 2024-11-27
]

---







class: middle

&lt;img src="images/poisson_dist.jpg" width="90%" style="display: block; margin: auto;" /&gt;

---

class: middle
**Expected competencies:**
- Knowledge about linear, logistic and binomial regressions.
- Knowledge about count data and Poisson distribution.

--

### Objectives
- Revise Poisson distribution and model assumptions
- Provide tools to estimate Risk Ratios, Risk Difference and Rate Ratios using Poisson regressions


---
class:middle
### Poisson distribution
The Poisson distribution gives the probability mass function (discrete) of all possible numbers of new cases, from 0 to `\(\infty\)`.     
&lt;br&gt;   
If `\(Y_i\)`= # of new cases with `\(\lambda\)` = expected number of cases in a given time period and `$$Y_i \sim  Poisson (\lambda)$$` 

--

then the probability mass function that `\(Y=k\)`, is: 
`$$P(Y=k) = \dfrac{\lambda^{k}e^{-\lambda}}{k!}$$`

--

for `\(k = 0, 1, 2,\)` ... and `\(λ &gt; 0\)`, where `\(λ\)` is both the mean and the variance of `\(K\)`; where 
`\(λ\)` = expected number of cases in a given time period.

---
class:middle
### Poisson distribution
This can be also presented as:
`$$y_i ∼Poisson(e^{X_iβ})$$`

where the linear predictor `\(X_i β\)` is the logarithm of the expected value of measurement `\(y_i\)`, or `\(ln(\lambda)\)`. 

- In count-data regressions, each unit `\(i\)` corresponds to a setting (typically a spatial location or a time interval) in which `\(y_i\)` events are observed.

--
&lt;br&gt;

- Under the Poisson model, `\(sd( y_i ) = \sqrt E(y_i)\)`; thus if the model accurately describes the data, we also have a sense of how much variation we would expect from the fitted curve.

**.red[For a Poisson random variable, the  variance = mean =]** **E(Y) = `\(\lambda\)`**  

---
class:middle
### Poisson distribution
&lt;img src="L21_EPIB704_Poisson_Regression_files/figure-html/unnamed-chunk-2-1.png" width="60%" style="display: block; margin: auto;" /&gt;
--
**Checking distribution**
.pull-left[

```r
mean(dat$art)
```

```
## [1] 1.692896
```
]
.pull-right[

```r
sd(dat$art); var(dat$art)
```

```
## [1] 1.926069
```

```
## [1] 3.709742
```
]

---
class:middle
### Poisson considerations

- As `\(λ\)` increases Poisson distribution approximates to a normal distribution
- When `\(n\)` is large and `\(p\)` is very small, Poisson distribution approximates the binomial distribution.  

--

.pull-left[
**Example:** Consider binomial distribution with probability = 0.01. What is the probability of 6 occurrences in 1200 tries?


```r
# binomial
dbinom(6,1200,0.01)
```

```
## [1] 0.02516172
```

```r
# poisson
dpois(6,1200*0.01) # lambda = n*p 
```

```
## [1] 0.02548128
```
]

--

.pull-right[
**To approximate the true (binomial) results:**

To approximate the mean
- `\(µ = E(X) = λ = np\)`

To approximate the standard deviation.
- `\(σ = sqrt(λ)= sqrt(np)\)`
]

---
class:middle
### Poisson considerations

&lt;img src="L21_EPIB704_Poisson_Regression_files/figure-html/unnamed-chunk-6-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---
class:middle
## Poisson Model Assumptions

**Poisson Response:** The response variable is a count per unit of time or space.

**Independence:** The observations must be independent of one another.

**Mean = Variance:** Conditional means equal the conditional variances. 

**Linearity:** The log of the mean rate, log(λ), must be a linear function of x.
- the mean values of  `\(Y\)` at each level of  `\(X\)`, `\(λ_{Y|X}\)`, fall on a curve, not a line, although the logs of the means should follow a line.
 

---
class:middle
## Poisson Model

- A generalized linear model with a log link and a Poisson distribution,
- Used to model count variables 
- A natural model for rates in data sets with person time (e.g: Mortality). 

--

.blue[
- Under predicts zero counts and over predicts the first set of counts
- Assumes same rate of outcome among the individual observations but incorporating “observed heterogeneity” relax this assumption.
]


---
class:middle
### Illustration using the articles and PhD years after graduation
.pull-left[
<div id="ihcuecivbt" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ihcuecivbt table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ihcuecivbt thead, #ihcuecivbt tbody, #ihcuecivbt tfoot, #ihcuecivbt tr, #ihcuecivbt td, #ihcuecivbt th {
  border-style: none;
}

#ihcuecivbt p {
  margin: 0;
  padding: 0;
}

#ihcuecivbt .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ihcuecivbt .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ihcuecivbt .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ihcuecivbt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ihcuecivbt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ihcuecivbt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ihcuecivbt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ihcuecivbt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ihcuecivbt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ihcuecivbt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ihcuecivbt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ihcuecivbt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ihcuecivbt .gt_spanner_row {
  border-bottom-style: hidden;
}

#ihcuecivbt .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ihcuecivbt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ihcuecivbt .gt_from_md > :first-child {
  margin-top: 0;
}

#ihcuecivbt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ihcuecivbt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ihcuecivbt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ihcuecivbt .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ihcuecivbt .gt_row_group_first td {
  border-top-width: 2px;
}

#ihcuecivbt .gt_row_group_first th {
  border-top-width: 2px;
}

#ihcuecivbt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ihcuecivbt .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ihcuecivbt .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ihcuecivbt .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ihcuecivbt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ihcuecivbt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ihcuecivbt .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ihcuecivbt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ihcuecivbt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ihcuecivbt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ihcuecivbt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ihcuecivbt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ihcuecivbt .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ihcuecivbt .gt_left {
  text-align: left;
}

#ihcuecivbt .gt_center {
  text-align: center;
}

#ihcuecivbt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ihcuecivbt .gt_font_normal {
  font-weight: normal;
}

#ihcuecivbt .gt_font_bold {
  font-weight: bold;
}

#ihcuecivbt .gt_font_italic {
  font-style: italic;
}

#ihcuecivbt .gt_super {
  font-size: 65%;
}

#ihcuecivbt .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ihcuecivbt .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ihcuecivbt .gt_indent_1 {
  text-indent: 5px;
}

#ihcuecivbt .gt_indent_2 {
  text-indent: 10px;
}

#ihcuecivbt .gt_indent_3 {
  text-indent: 15px;
}

#ihcuecivbt .gt_indent_4 {
  text-indent: 20px;
}

#ihcuecivbt .gt_indent_5 {
  text-indent: 25px;
}

#ihcuecivbt .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#ihcuecivbt div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="&lt;span class='gt_from_md'&gt;&lt;strong&gt;Characteristic&lt;/strong&gt;&lt;/span&gt;"><span class='gt_from_md'><strong>Characteristic</strong></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;span class='gt_from_md'&gt;&lt;strong&gt;N = 915&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><span class='gt_from_md'><strong>N = 915</strong></span><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left" style="font-weight: bold;">art</td>
<td headers="stat_0" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Mean; Median (Q1, Q3)</td>
<td headers="stat_0" class="gt_row gt_center">1.69; 1.00 (0.00, 2.00)</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-weight: bold;">fem</td>
<td headers="stat_0" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Men</td>
<td headers="stat_0" class="gt_row gt_center">494 / 915 (54%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Women</td>
<td headers="stat_0" class="gt_row gt_center">421 / 915 (46%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-weight: bold;">mar</td>
<td headers="stat_0" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Married</td>
<td headers="stat_0" class="gt_row gt_center">606 / 915 (66%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Single</td>
<td headers="stat_0" class="gt_row gt_center">309 / 915 (34%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-weight: bold;">phd</td>
<td headers="stat_0" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Mean; Median (Q1, Q3)</td>
<td headers="stat_0" class="gt_row gt_center">3.10; 3.15 (2.26, 3.92)</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="2"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span> <span class='gt_from_md'>n / N (%)</span></td>
    </tr>
  </tfoot>
</table>
</div>
]
.pull-right[
<div id="aiucxbgiuw" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#aiucxbgiuw table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#aiucxbgiuw thead, #aiucxbgiuw tbody, #aiucxbgiuw tfoot, #aiucxbgiuw tr, #aiucxbgiuw td, #aiucxbgiuw th {
  border-style: none;
}

#aiucxbgiuw p {
  margin: 0;
  padding: 0;
}

#aiucxbgiuw .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#aiucxbgiuw .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#aiucxbgiuw .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#aiucxbgiuw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#aiucxbgiuw .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#aiucxbgiuw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#aiucxbgiuw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#aiucxbgiuw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#aiucxbgiuw .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#aiucxbgiuw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#aiucxbgiuw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#aiucxbgiuw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#aiucxbgiuw .gt_spanner_row {
  border-bottom-style: hidden;
}

#aiucxbgiuw .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#aiucxbgiuw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#aiucxbgiuw .gt_from_md > :first-child {
  margin-top: 0;
}

#aiucxbgiuw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#aiucxbgiuw .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#aiucxbgiuw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#aiucxbgiuw .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#aiucxbgiuw .gt_row_group_first td {
  border-top-width: 2px;
}

#aiucxbgiuw .gt_row_group_first th {
  border-top-width: 2px;
}

#aiucxbgiuw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#aiucxbgiuw .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#aiucxbgiuw .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#aiucxbgiuw .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#aiucxbgiuw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#aiucxbgiuw .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#aiucxbgiuw .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#aiucxbgiuw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#aiucxbgiuw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#aiucxbgiuw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#aiucxbgiuw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#aiucxbgiuw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#aiucxbgiuw .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#aiucxbgiuw .gt_left {
  text-align: left;
}

#aiucxbgiuw .gt_center {
  text-align: center;
}

#aiucxbgiuw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#aiucxbgiuw .gt_font_normal {
  font-weight: normal;
}

#aiucxbgiuw .gt_font_bold {
  font-weight: bold;
}

#aiucxbgiuw .gt_font_italic {
  font-style: italic;
}

#aiucxbgiuw .gt_super {
  font-size: 65%;
}

#aiucxbgiuw .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#aiucxbgiuw .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#aiucxbgiuw .gt_indent_1 {
  text-indent: 5px;
}

#aiucxbgiuw .gt_indent_2 {
  text-indent: 10px;
}

#aiucxbgiuw .gt_indent_3 {
  text-indent: 15px;
}

#aiucxbgiuw .gt_indent_4 {
  text-indent: 20px;
}

#aiucxbgiuw .gt_indent_5 {
  text-indent: 25px;
}

#aiucxbgiuw .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#aiucxbgiuw div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="&lt;span class='gt_from_md'&gt;&lt;strong&gt;Characteristic&lt;/strong&gt;&lt;/span&gt;"><span class='gt_from_md'><strong>Characteristic</strong></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;span class='gt_from_md'&gt;&lt;strong&gt;N = 915&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><span class='gt_from_md'><strong>N = 915</strong></span><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left" style="font-weight: bold;">profage</td>
<td headers="stat_0" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Mean; Median (Q1, Q3)</td>
<td headers="stat_0" class="gt_row gt_center">33.2; 33.0 (31.0, 36.0)</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-weight: bold;">kid5</td>
<td headers="stat_0" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    0</td>
<td headers="stat_0" class="gt_row gt_center">599 / 915 (65%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    1</td>
<td headers="stat_0" class="gt_row gt_center">195 / 915 (21%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    2</td>
<td headers="stat_0" class="gt_row gt_center">105 / 915 (11%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    3</td>
<td headers="stat_0" class="gt_row gt_center">16 / 915 (1.7%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-weight: bold;">ment</td>
<td headers="stat_0" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Mean; Median (Q1, Q3)</td>
<td headers="stat_0" class="gt_row gt_center">9; 6 (3, 12)</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="2"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span> <span class='gt_from_md'>n / N (%)</span></td>
    </tr>
  </tfoot>
</table>
</div>

]
---
class:middle
### Illustration using the articles and PhD years after graduation


```r
pois0 &lt;- glm(art ~ 1, family= "poisson", data = dat)
```
--
** Exponentiated coefficient**

```
##             exp(Est.) 2.5% 97.5% z val. p
## (Intercept)      1.69 1.61  1.78  20.72 0
```

--
**Summary**

```
## 
## Call:
## glm(formula = art ~ 1, family = "poisson", data = dat)
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  0.52644    0.02541   20.72   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 1817.4  on 914  degrees of freedom
## Residual deviance: 1817.4  on 914  degrees of freedom
## AIC: 3487.1
## 
## Number of Fisher Scoring iterations: 5
```


---
class:middle
**Illustration using the articles and PhD years after graduation**
&lt;table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Observations &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 915 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Dependent variable &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; art &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Type &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; Generalized linear model &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Family &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; poisson &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Link &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; log &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt; &lt;table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; 𝛘²(0) &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -0.00 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Pseudo-R² (Cragg-Uhler) &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.00 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Pseudo-R² (McFadden) &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.00 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; AIC &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3487.15 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; BIC &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3491.97 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt; &lt;table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; exp(Est.) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; 2.5% &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; 97.5% &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; z val. &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; p &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.69 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.61 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.78 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 20.72 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.00 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; Standard errors: MLE&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;

---
class:middle
### Illustration using the articles and PhD years after graduation

&lt;img src="images/artpredict.gif" width="60%" style="display: block; margin: auto;" /&gt;

---
class:middle
### Illustration using the articles and PhD years after graduation
If the follow-up time is not specified, the software assumes that person time is one for everyone, and Poisson regression actually produces the RISK ratio: 

--

.pull-left[

```r
pois1 &lt;- glm(art ~ fem + mar, 
*            poisson(link="log"),
             data = dat) 
round(jtools::summ(pois1, confint= T, 
                   exp = T)$"coeftable", 2) ; #summary(pois1)
```

```
##             exp(Est.) 2.5% 97.5% z val.    p
## (Intercept)      1.89 1.77  2.03  18.19 0.00
## femWomen         0.79 0.71  0.87  -4.49 0.00
## marSingle        0.97 0.87  1.09  -0.50 0.62
```
]

--

.pull-right[
&lt;img src="images/poisPRM.gif" width="120%" style="display: block; margin: auto;" /&gt;
]


---
class:middle
### Illustration using the articles and PhD years after graduation
To get the RATE ratio instead of RISK ratio, we need to tell the software where to find the follow-up time: 


```r
*dat$logprofage &lt;- log(dat$profage)
#summary(dat$profage)
*pois2a &lt;- glm(art ~ fem + mar + offset(logprofage),
             poisson(link="log"), data = dat)
```

--



```
##             exp(Est.) 2.5% 97.5% z val.   p
## (Intercept)      0.06 0.05  0.06 -81.49 0.0
## femWomen         0.79 0.72  0.88  -4.30 0.0
## marSingle        0.97 0.87  1.08  -0.52 0.6
```

**.purple[The exponentiated coefficient give then the Rate Ratio.]**

---
class:middle
### Illustration using the articles and PhD years after graduation

&lt;img src="images/artpred_T.gif" width="60%" style="display: block; margin: auto;" /&gt;
--
**comparing "goodness-of-fit" using AIC (Akaike Information Criteria)**

```
##         Empty     Risk     Rate
## [1,] 3487.147 3467.868 3470.165
```

---
class:middle
### Illustration using the articles and PhD years after graduation

```r
*pois2b &lt;- glm(art ~ fem + mar + offset(profage),
             poisson(link="log"), data = dat)
round(jtools::summ(pois2b, confint= T, exp = T)$"coeftable", 2)
```

```
##             exp(Est.) 2.5% 97.5%  z val.    p
## (Intercept)      0.00 0.00  0.00 -997.79 0.00
## femWomen         1.04 0.94  1.15    0.76 0.45
## marSingle        0.71 0.64  0.79   -6.15 0.00
```

.red[Using the variable age without the log-transformation changes the estimates and the likelihood is affected as evidenced by the AIC]

**comparing "goodness-of-fit" using AIC (Akaike Information Criteria)**

```
##         Empty     Risk     Rate Rate_nolog
## [1,] 3487.147 3467.868 3470.165   14060.01
```
---
class:middle
### Illustration using the articles and PhD years after graduation
&lt;img src="images/artpred_T1.png" width="60%" style="display: block; margin: auto;" /&gt;
- Under predicts zero counts and over predicts the first set of counts
- Assumes same rate of outcome among the individual observations but incorporating “observed heterogeneity” relax this assumption.

---
class:middle
### Poisson Models for Risk Ratios and Risk Differences
Recall our example: **Wells in Bangladesh** 


.pull-left[
<div id="qeayjdrzqo" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#qeayjdrzqo table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#qeayjdrzqo thead, #qeayjdrzqo tbody, #qeayjdrzqo tfoot, #qeayjdrzqo tr, #qeayjdrzqo td, #qeayjdrzqo th {
  border-style: none;
}

#qeayjdrzqo p {
  margin: 0;
  padding: 0;
}

#qeayjdrzqo .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qeayjdrzqo .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#qeayjdrzqo .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qeayjdrzqo .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qeayjdrzqo .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qeayjdrzqo .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qeayjdrzqo .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qeayjdrzqo .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qeayjdrzqo .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qeayjdrzqo .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qeayjdrzqo .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qeayjdrzqo .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qeayjdrzqo .gt_spanner_row {
  border-bottom-style: hidden;
}

#qeayjdrzqo .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#qeayjdrzqo .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qeayjdrzqo .gt_from_md > :first-child {
  margin-top: 0;
}

#qeayjdrzqo .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qeayjdrzqo .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qeayjdrzqo .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qeayjdrzqo .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qeayjdrzqo .gt_row_group_first td {
  border-top-width: 2px;
}

#qeayjdrzqo .gt_row_group_first th {
  border-top-width: 2px;
}

#qeayjdrzqo .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qeayjdrzqo .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qeayjdrzqo .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qeayjdrzqo .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qeayjdrzqo .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qeayjdrzqo .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qeayjdrzqo .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#qeayjdrzqo .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qeayjdrzqo .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qeayjdrzqo .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qeayjdrzqo .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qeayjdrzqo .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qeayjdrzqo .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qeayjdrzqo .gt_left {
  text-align: left;
}

#qeayjdrzqo .gt_center {
  text-align: center;
}

#qeayjdrzqo .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qeayjdrzqo .gt_font_normal {
  font-weight: normal;
}

#qeayjdrzqo .gt_font_bold {
  font-weight: bold;
}

#qeayjdrzqo .gt_font_italic {
  font-style: italic;
}

#qeayjdrzqo .gt_super {
  font-size: 65%;
}

#qeayjdrzqo .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#qeayjdrzqo .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qeayjdrzqo .gt_indent_1 {
  text-indent: 5px;
}

#qeayjdrzqo .gt_indent_2 {
  text-indent: 10px;
}

#qeayjdrzqo .gt_indent_3 {
  text-indent: 15px;
}

#qeayjdrzqo .gt_indent_4 {
  text-indent: 20px;
}

#qeayjdrzqo .gt_indent_5 {
  text-indent: 25px;
}

#qeayjdrzqo .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#qeayjdrzqo div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="&lt;span class='gt_from_md'&gt;&lt;strong&gt;Characteristic&lt;/strong&gt;&lt;/span&gt;"><span class='gt_from_md'><strong>Characteristic</strong></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;span class='gt_from_md'&gt;&lt;strong&gt;N = 3,020&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><span class='gt_from_md'><strong>N = 3,020</strong></span><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">switch</td>
<td headers="stat_0" class="gt_row gt_center">1,737 (58%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">arsenic</td>
<td headers="stat_0" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Median (Q1, Q3)</td>
<td headers="stat_0" class="gt_row gt_center">1.30 (0.82, 2.20)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Min, Max</td>
<td headers="stat_0" class="gt_row gt_center">0.51, 9.65</td></tr>
    <tr><td headers="label" class="gt_row gt_left">dist100</td>
<td headers="stat_0" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Median (Q1, Q3)</td>
<td headers="stat_0" class="gt_row gt_center">0.37 (0.21, 0.64)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Min, Max</td>
<td headers="stat_0" class="gt_row gt_center">0.00, 3.40</td></tr>
    <tr><td headers="label" class="gt_row gt_left">assoc</td>
<td headers="stat_0" class="gt_row gt_center">1,277 (42%)</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="2"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span> <span class='gt_from_md'>n (%)</span></td>
    </tr>
  </tfoot>
</table>
</div>
]

--
.pull-right[
&lt;img src="L21_EPIB704_Poisson_Regression_files/figure-html/unnamed-chunk-25-1.png" width="150%" height="150%" style="display: block; margin: auto;" /&gt;
]


---
class:middle
### Recall our example: **Wells in Bangladesh** 

**.black[Model "switching" to a safer well (outcome) as a function of whether the owner belongs to a community association and As. level.]**
&lt;br&gt;


|Model                       |	Frequentist Estimates|
|:---------------------------|:-------------------:|
|Linear Model `\(^1\)`     |    RD= -0.036; RR= N/A       |
|Logit Model (Predicted probs.) `\(^2\)`| RD= -0.033; RR= 0.939|
|AME (prediction `StdGLM`) `\(^2\)` | RD= -0.031; RR= 0.948 |
|GLM: Log-Binomial `\(^2\)` |RD= N/A; RR= 0.928|

&lt;br&gt;


`\(^1\)` Single predictor;  `\(^2\)` Two predictors
 
---
class:middle
### Poisson Model and Risk Ratios
–our example- **Wells in Bangladesh** 

```r
mod.glm.p.rr &lt;- glm(switch ~ assoc + arsenic, data = wells, 
*                   family=poisson(link="log"))
```
--

```
#&gt; 
#&gt; Call:
#&gt; glm(formula = switch ~ assoc + arsenic, family = poisson(link = "log"), 
#&gt;     data = wells)
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    
#&gt; (Intercept)  -0.7489     0.0473  -15.83  &lt; 2e-16 ***
#&gt; assoc        -0.0559     0.0488   -1.14     0.25    
#&gt; arsenic       0.1258     0.0192    6.55  5.6e-11 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; (Dispersion parameter for poisson family taken to be 1)
#&gt; 
#&gt;     Null deviance: 1921.5  on 3019  degrees of freedom
#&gt; Residual deviance: 1880.2  on 3017  degrees of freedom
#&gt; AIC: 5360
#&gt; 
#&gt; Number of Fisher Scoring iterations: 5
```

---
class:middle
Poisson Model and RRs –our example- **Wells in Bangladesh** 
&lt;table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Observations &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3020 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Dependent variable &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; switch &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Type &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; Generalized linear model &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Family &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; poisson &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Link &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; log &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt; &lt;table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; 𝛘²(2) &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 41.25 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Pseudo-R² (Cragg-Uhler) &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.02 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; Pseudo-R² (McFadden) &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.01 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; AIC &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5360.21 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; BIC &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5378.25 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt; &lt;table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; exp(Est.) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; 2.5% &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; 97.5% &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; z val. &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; p &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.47 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.43 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.52 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -15.83 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.00 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; assoc &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.95 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.86 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.04 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -1.14 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.25 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;"&gt; arsenic &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.13 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.09 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.18 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6.55 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.00 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; Standard errors: MLE&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;

---
class:middle
### Poisson Model and Risk Ratios, our example- Wells in Bangladesh 


```
#&gt;             exp(Est.)  2.5% 97.5% z val.        p
#&gt; (Intercept)     0.473 0.431 0.519 -15.83 1.82e-56
#&gt; assoc           0.946 0.859 1.041  -1.14 2.52e-01
#&gt; arsenic         1.134 1.092 1.178   6.55 5.61e-11
```

--

&lt;br&gt;
- Poisson models provides RISK ratios with biased confidence intervals.
- The model assumes a Poisson distribution when in fact the outcomes are binary.  
- To overcome issues with the variance, we could use a variance estimator that is robust to the misspecification of the model. 

---
class:middle
### Poisson Model and RRs (Robust Variance)
–our example- **Wells in Bangladesh** 

```r
jtools::summ(mod.glm.p.rr, confint=T, exp=T, 
*            robust= "HC0")$"coeftable"
```

```
#&gt;             exp(Est.)  2.5% 97.5% z val.         p
#&gt; (Intercept)     0.473 0.445 0.502 -24.48 2.63e-132
#&gt; assoc           0.946 0.889 1.006  -1.77  7.74e-02
#&gt; arsenic         1.134 1.110 1.159  11.50  1.33e-30
```

--

**Quasi-Poisson Risk Ratio**

```r
mod.glm.qp.rr &lt;- glm(switch ~ assoc + arsenic, data = wells, 
*                    family= quasipoisson(link="log"))
jtools::summ(mod.glm.qp.rr, confint=T, exp=T)$"coeftable"
```

```
#&gt;             exp(Est.)  2.5% 97.5% t val.         p
#&gt; (Intercept)     0.473 0.445 0.502 -24.31 2.19e-119
#&gt; assoc           0.946 0.888 1.006  -1.76  7.90e-02
#&gt; arsenic         1.134 1.107 1.162  10.06  1.87e-23
```
.small[*Note: Pseudo-R2 for quasibinomial/quasipoisson families is calculated by refitting the fitted and null models as
binomial/poisson.]

---
class:middle
### Poisson Model and Risk Differences
–our example- **Wells in Bangladesh** 

```r
mod.glm.p.rd &lt;- glm(switch ~ assoc + arsenic, data = wells, 
*                   family=poisson(link="identity"))
```

--


```
#&gt; 
#&gt; Call:
#&gt; glm(formula = switch ~ assoc + arsenic, family = poisson(link = "identity"), 
#&gt;     data = wells)
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    
#&gt; (Intercept)   0.4388     0.0278   15.80  &lt; 2e-16 ***
#&gt; assoc        -0.0268     0.0275   -0.97     0.33    
#&gt; arsenic       0.0891     0.0138    6.47  9.8e-11 ***
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
#&gt; 
#&gt; (Dispersion parameter for poisson family taken to be 1)
#&gt; 
#&gt;     Null deviance: 1921.5  on 3019  degrees of freedom
#&gt; Residual deviance: 1876.2  on 3017  degrees of freedom
#&gt; AIC: 5356
#&gt; 
#&gt; Number of Fisher Scoring iterations: 5
```


---
class:middle
### Poisson Model and Risk Differences

```r
jtools::summ(mod.glm.p.rd, confint=T)$"coeftable"
```

```
#&gt;                Est.    2.5%  97.5% z val.        p
#&gt; (Intercept)  0.4388  0.3844 0.4932 15.800 3.09e-56
#&gt; assoc       -0.0268 -0.0806 0.0271 -0.974 3.30e-01
#&gt; arsenic      0.0891  0.0621 0.1161  6.470 9.83e-11
```

--

**Quasi-Poisson Risk Difference (Robust Variance)**

```r
mod.glm.qp.rd1 &lt;- glm(switch ~ assoc + arsenic, data = wells, 
*                     family= quasipoisson(link="identity")) #
jtools::summ(mod.glm.qp.rd1, confint=T)$"coeftable"
```

```
#&gt;                Est.    2.5%   97.5% t val.         p
#&gt; (Intercept)  0.4388  0.4033 0.47429  24.23 1.19e-118
#&gt; assoc       -0.0268 -0.0619 0.00837  -1.49  1.36e-01
#&gt; arsenic      0.0891  0.0715 0.10674   9.92  7.54e-23
```

---
class:middle
**Why and When do we use Poisson for Risk Ratios and Risk Differences?**

**.purple[Poisson regression]**
- Used for rare outcomes 
- When the follow-up has different lengths 

--

**.black[Logistic regression:]**
Used with same length of follow-up time

--

**.blue[Poisson approximation to Binomial]**
- Cohort studies where all patients have equal follow-up times. 
- Poisson regression can be used similarly as logistic regression, with a time-at-risk value specified as 1 for each subject. 
- If the model adequately fits the data, this provides a correct estimate of the AdjRR

&lt;br&gt;

.small[Chen et al.: Comparison of robustness to outliers between robust poisson models and log-binomial models when estimating relative risks for common binary outcomes: a simulation study. BMC Medical Research Methodology 2014 14:82.
]

---
class:middle
## Comparing Results
**.black[Model "switching" to a safer well (outcome) as a function of whether the owner belongs to a community association and As. level.]**
&lt;br&gt;


|Model                       |	Frequentist Estimates|
|:---------------------------|:-------------------:|
|Linear Model `\(^1\)`     |    RD= -0.036; RR= N/A       |
|Logit Model (Predicted probs.) `\(^2\)`| RD= -0.033; RR= 0.939|
|AME (prediction `StdGLM`) `\(^2\)` | RD= -0.031; RR= 0.948 |
|GLM: Log-Binomial `\(^2\)` |RD= N/A; RR= 0.928|
| .red[Poisson Model] `\(^2\)` | .red[RD = -0.027; RR= 0.946]|

`\(^1\)` Single predictor;  `\(^2\)` Two predictors

---
class:middle
**Why and When do we use Poisson for Risk Ratios and Risk Differences?**

- For common outcomes, Poisson regression is likely to compute a confidence interval(s) that is conservative, suggesting less precision than is true. 

- Poisson regression produces wider confidence intervals (compared with a log-binomial model and stratified analysis) because Poisson errors are overestimates of binomial errors when the outcome is common 

- Poisson errors approximately equal binomial errors when the outcome is rare

&lt;br&gt;

.small[
Guangyong Zou. A Modified Poisson Regression Approach to Prospective Studies with Binary Data, AJE, Vol 159: 7 (2004).702–706 (https://doi.org/10.1093/aje/kwh090).

Chen et al. Comparison of robustness to outliers between robust poisson models and log-binomial models when estimating relative risks for common binary outcomes: a simulation study. BMC Med Res Method 2014 14:82.
]



---
class:middle
### Robust Poisson models
- The Poisson regression uses a logarithm as the natural link function under the generalized linear model framework. 

- The robust Poisson regression model uses the classical sandwich estimator under the generalized estimation equation (GEE) framework to correct the inflated variance (also known as over-dispersion) in the standard Poisson regression. 

- The technique is known as modified Poisson regression or pseudo-likelihood estimation.

- This correction can be achieved by using the `robust` option form `jtools` in `R` or the `quasipoisson` from `glm`, also using the REPEATED statement in SAS Proc GENMOD; the ROBUST option in STATA’s Poisson procedure. 


---
class:middle
### Robust Poisson models vs. Log-Binomial

- In presence of linear confounders, the two models yield comparable relative biases.

- With the non-linear confounders, the robust Poisson model outperform the log-binomial model. Larger differences with rare outcomes.

- The robust Poisson models are more robust to outliers compared to the log-binomial models when estimating relative risks or risk ratios for common binary outcomes.


.small[Chen et al. Comparison of robustness to outliers between robust poisson models and log-binomial models when estimating relative risks for common binary outcomes: a simulation study. BMC Medical Research Methodology 2014 14:82.
]


---
class:middle
### Log-Binomial vs Robust Poisson?
- Of the two methods, the log-binomial method is generally preferred due to the fact that the MLEs estimated by the log-binomial models are more efficient compared to the pseudo-likelihood estimators used by the robust Poisson models.

- Spiegelman and Hertzmark recommend using the log-binomial models over the robust Poisson models when convergence is not an issue.

- It appears that the gain in efficiency is beneficial to log-binomial models only for samples of small sizes.

- Due to the concern of lack of efficiency for the robust Poisson models for small samples, log-binomial may still be the choice when the sample size is small.



---
class:middle
### Other Count Models

- Negative Binomial (Overdispersed Poisson Models)

- Zero Inflated Models

- Zero Truncated Models


.pull-right[
### .red[… Out of the scope for this session ]
]


---
class: middle

###  QUESTIONS? 

## COMMENTS?

# RECOMMENDATIONS?

---
class:middle
## Distributions
&lt;img src="images/distributions.png" width="80%" style="display: block; margin: auto;" /&gt;

Vittinghoff E., Glidden D.V., Shiboski S.C., McCulloch C.E. (2012) Generalized Linear Models. In: Regression Methods in Biostatistics. Statistics for Biology and Health. Springer, Boston, MA

---
class:middle
### Log-Binomial vs Robust Poisson?
- Software utilizes iterative weighted least squares (IWLS*) approach or variations of IWLS to find MLEs for generalized linear models. 
- For log-binomial models, the weights used by the IWLS approach contain the term 1/(1-p), where `\(p = exp(XTβ)\)` with a range from 0 to 1. 
- The MLE of a log-binomial model is likely to be too sensitive to outliers because a very large p has a large influence on the weights.
- MLE and pseudolikelihood estimators are deteriorated in presence of outliers. 
- The level of deterioration differed when the relationships between the confounder and the outcome was not in a simple form

---
class:middle
### Maximum likelihood estimate of lambda 
`$$MLE = \ell(\lambda; y_1, \dots, y_n) = \sum_{i = 1}^n \log f(y_i; \lambda) = \sum_{i = 1}^n \log \frac{\lambda^{y_1}exp^{-\lambda}}{y_1!}$$`

Take first derivative (notation `\(\prime = \frac{d(.)}{d\lambda}\)`) 


`\(\ell^\prime(\lambda; y_1, \dots, y_n) =  \sum_{i = 1}^n \log \frac{\lambda^{y_1}exp^{-\lambda}}{y_1!}^\prime\)`
                                      `\(= \sum_{i = 1}^n \left\{ -\lambda + y_i \cdot \log(\lambda) - \log(y_i!) \right\}^\prime\)`
                                      `\(= \sum_{i = 1}^n \left\{ -1 + y_i \cdot \frac{1}{\lambda} \right\}\)`
                                      `\(= -n + \frac{1}{\lambda} \sum_{i = 1}^n y_i\)`    
                                      
---
class:middle
### Maximum likelihood estimate of lambda                                       
The first-order condition for maximizing the log-likelihood sets its derivative to zero

`$$\ell^\prime(\lambda; y_1, \dots, y_n)  = 0$$`
`$$-n + \frac{1}{\lambda} \sum_{i = 1}^n y_i = 0$$`
`$$n \cdot \lambda  = \sum_{i = 1}^n y_i$$`
`$$\lambda = \frac{1}{n} \sum_{i = 1}^n y_i = \bar y$$`
  
Thus, the maximum likelihood estimator is simply the empirical mean `\(\hat \lambda = \bar y\)`

---
class:middle
## Poisson distribution (PD)
If instead are given the average rate, *r*, at which events occur then `\(\lambda = rt\)`, and
`$$P(k\, events\, in\, interval\, t) = \dfrac{rt^{k}e^{-rt}}{k!}$$`
---
class:middle
## Poisson distribution (PD)
PD a special case of the binomial, with trials n -&gt; `\(\infty\)` and P(success in any trial) -&gt; 0       
If p is small, binomial P(k successes) `\(\approx\)` poisson P(k with `\(\lambda\)` = np)     
&lt;br&gt;
**Example:** Consider binomial distribution with probability = 0.01. What is the probability of 8 occurences in 1000 tries?


```r
# binomial
dbinom(8,1000,0.01)
```

```
#&gt; [1] 0.113
```

```r
# poisson
dpois(8,1000*.01) # lambda = n*p 
```

```
#&gt; [1] 0.113
```

---
class: middle
### Offset vs Exposure  
In most applications of count-data regression, there is a baseline or exposure, some value such as the  number of person years that the counts occurred over

We can  model `\(y_i\)` as the number of cases in a process with rate `\(\theta_i\)` and exposure `\(\mu_i\)`  
`$$y_i \sim negative \, binomial (\mu_i \theta_i, \phi)$$`  

where, as before, `\(\theta_i = e^{X_i \beta}\)` and includes Poisson regression as the special case of  φ → ∞    

The logarithm of the exposure, `\(log(\mu_i)\)`, is called the offset in GLM terminology.     

The regression coefficients `\(\beta\)` now reflect the associations between the predictors and `\(\theta_i\)` (for example, the rate of deaths)   

Putting the logarithm of the exposure into the model as an offset, is equivalent to  including it as a regression predictor, but with its coefficient fixed to the value 1.  Another option is to include it as a predictor and let its coefficient be estimated from the data.

---
class: middle
## AIC	=	Akaike information criterion

`\(AIC = - 2(log-likelihood) + kn_{par}\)`, where `\(k=2\)`, equivalently

`\(AIC = 2k-2 \mathrm {\ln}(\hat {L})\)`

`\(k\)` =	number of estimated parameters in the model
`\(\hat {L}\)`	=	maximum value of the likelihood function for the model

Given a collection of models for the data, AIC estimates the quality of each model, relative to each of the other models. 

Hence, AIC provides a means for model selection

---
class: middle
## BIC	=	Bayesian Information Criterion

`\(BIC = - 2(log-likelihood) + kn_{par}\)`, 

where `\(k= log(n)\)`, 

and `\(n\)` is the number of observations

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "3:2",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"navigation": {
"scroll": false
}
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
